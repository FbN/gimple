<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Gimple : Micro, performant, and thread safe dependency injection container for jvm. Inspired by PHP Pimple. Written in Groovy. Powered by Google Guava Stripe.">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Gimple</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/FbN/gimple">View on GitHub</a>

          <h1 id="project_title">Gimple</h1>
          <h2 id="project_tagline">Micro, performant, and thread safe dependency injection container for jvm. Inspired by PHP Pimple. Written in Groovy. Powered by Google Guava Stripe.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/FbN/gimple/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/FbN/gimple/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="gimple" class="anchor" href="#gimple"><span class="octicon octicon-link"></span></a>Gimple</h1>

<p>Gimple is a small Dependency Injection Container for Groovy, Java and more generally for JVM. Consists of just one class ( ... maybe two ) and it's inspired (and in many points carbon-copied) from the <a href="http://pimple.sensiolabs.org/">PHP Pimple project</a></p>

<p>Homepage: <a href="http://fbn.github.io/gimple/">http://fbn.github.io/gimple/</a></p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>
<strong>Simple</strong>: one (... maybe two) class.</li>
<li>
<strong>Modern</strong>: strong use of closures.</li>
<li>
<strong>Thread safety &amp; efficiency</strong>: powered by <a href="https://code.google.com/p/guava-libraries/wiki/StripedExplained">Guava Stripe</a>. Tested with <a href="http://thread-safe.org/">thread-safe.org</a>.</li>
<li>
<strong>Nice API</strong>: the container is an <code>LinkedHashMap</code> extension. In groovy you can use it like a Map, [:].</li>
<li>
<strong>Prototype / Singleton</strong>: define singleton or prototype scoped services or parameters.</li>
</ul><h2>
<a name="why" class="anchor" href="#why"><span class="octicon octicon-link"></span></a>Why!?</h2>

<p>Java, and more generally JVM, already got many dependency injection containers (spring framework, google guice, picocontainer)
but all of them are heavy libraries composed of dozens of classes. </p>

<p>It's just a single class!</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Gimple is published via Maven:</p>

<ul>
<li>Maven repository: <a href="https://github.com/FbN/mvn/raw/master/">https://github.com/FbN/mvn/raw/master/</a>
</li>
<li>Maven artifact: com.github.gimple Gimple 0.1.2</li>
</ul><p>If you use gradle simply add the following lines to <em>build.gradle</em> file:</p>

<div class="highlight highlight-groovy"><pre><span class="n">repositories</span> <span class="o">{</span>
    <span class="n">maven</span> <span class="o">{</span>
        <span class="n">url</span> <span class="s1">'https://github.com/FbN/mvn/raw/master/'</span>
    <span class="o">}</span>
<span class="o">}</span> 

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s1">'com.github.gimple:Gimple:0.1.2'</span>
<span class="o">}</span>
</pre></div>

<h2>
<a name="api" class="anchor" href="#api"><span class="octicon octicon-link"></span></a>API</h2>

<h3>
<a name="instantiate" class="anchor" href="#instantiate"><span class="octicon octicon-link"></span></a>Instantiate</h3>

<div class="highlight highlight-groovy"><pre><span class="kt">def</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">gimple</span><span class="o">.</span><span class="na">Container</span><span class="o">()</span>
</pre></div>

<h3>
<a name="defining-services" class="anchor" href="#defining-services"><span class="octicon octicon-link"></span></a>Defining Services</h3>

<p>A service is an object that does something as part of a larger system. 
Examples of services are: </p>

<ul>
<li>a database connection</li>
<li>a templating engine</li>
<li>a mailer</li>
</ul><p>Almost any global object can be a service.
Services are defined by a closure that returns an instance of an object:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span> <span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nf">SessionStorage</span><span class="o">(</span><span class="s1">'SESSION_ID'</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">container</span><span class="o">[</span><span class="s1">'session'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span> <span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nf">Session</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">])</span>
<span class="o">}</span>
</pre></div>

<p>Notice that closure has access to the current container instance, allowing references to other services or parameters.</p>

<p>As objects are only created when you get them, the order of the definitions does not matter.</p>

<p>Using the defined services is also very easy:</p>

<div class="highlight highlight-groovy"><pre><span class="kt">def</span> <span class="n">session</span> <span class="o">=</span> <span class="n">container</span><span class="o">[</span><span class="s1">'session'</span><span class="o">]</span>
</pre></div>

<h3>
<a name="defining-factory-services" class="anchor" href="#defining-factory-services"><span class="octicon octicon-link"></span></a>Defining Factory Services</h3>

<p>By default, each time you get a service, Gimple returns the same instance of it. 
If you want a different instance to be returned for all calls, wrap your closure with the <code>factory()</code> method</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'session'</span><span class="o">]</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="na">factory</span><span class="o">(</span> <span class="o">{</span> <span class="n">c</span> <span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nf">Session</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">])</span>
<span class="o">})</span>
</pre></div>

<p>Now, each call to <code>container['session']</code> returns a new instance of the session.</p>

<h3>
<a name="defining-parameters" class="anchor" href="#defining-parameters"><span class="octicon octicon-link"></span></a>Defining Parameters</h3>

<p>Defining a parameter allows to ease the configuration of your container from the outside and to store global values:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'cookieName'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'SESSION_ID'</span>
<span class="n">container</span><span class="o">[</span><span class="s1">'sessionStorageClass'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'SessionStorage'</span>
</pre></div>

<p>If not a closure it is a parameter.</p>

<p>If you change the <code>sessionStorage</code> service definition like below:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span> <span class="o">-&gt;</span>
    <span class="k">new</span> <span class="s2">"${c['sessionStorageClass']}"</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'cookieName'</span><span class="o">])</span>
<span class="o">}</span>
</pre></div>

<h3>
<a name="protecting-parameters" class="anchor" href="#protecting-parameters"><span class="octicon octicon-link"></span></a>Protecting Parameters</h3>

<p>Because Gimple sees closures as a service definitions, you need to wrap closure with the <code>protect()</code> method to store them as parameters:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'randomFunc'</span><span class="o">]</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="na">protect</span><span class="o">({</span> <span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">()</span> <span class="o">})</span>
</pre></div>

<h3>
<a name="modifying-services-after-definition" class="anchor" href="#modifying-services-after-definition"><span class="octicon octicon-link"></span></a>Modifying Services after Definition</h3>

<p>You can replace a service simple reassigning a new value to id (the service must not be already used).
In some cases you may want to modify a service definition after it has been defined without replacing it. You can see it as a filter applied after the original service.
You can use the <code>extend()</code> method to define additional code to be run on your service just after it is created:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span> <span class="o">-&gt;</span>
    <span class="k">new</span> <span class="s2">"${c['sessionStorageClass']}"</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'cookieName'</span><span class="o">])</span>
<span class="o">};</span>

<span class="n">container</span><span class="o">.</span><span class="na">extend</span><span class="o">(</span><span class="s1">'sessionStorage'</span><span class="o">,</span> <span class="o">{</span><span class="n">storage</span><span class="o">,</span> <span class="n">c</span> <span class="o">-&gt;</span>
    <span class="o">...</span>
    <span class="k">do</span> <span class="n">anything</span> <span class="n">with</span> <span class="n">storage</span> <span class="n">and</span> <span class="n">c</span>
    <span class="o">...</span>

    <span class="n">storage</span>
<span class="o">})</span>
</pre></div>

<p>The first argument is the name of the service to extend, the second a function that gets access to the object instance and the container.</p>

<h3>
<a name="extending-a-container" class="anchor" href="#extending-a-container"><span class="octicon octicon-link"></span></a>Extending a Container</h3>

<p>If you use the same libraries over and over, you might want to reuse some services from one project in another one. Package your services into a provider by implementing <code>gimple.ServiceProviderInterface</code>:</p>

<div class="highlight highlight-groovy"><pre><span class="kd">class</span> <span class="nc">FooProvider</span> <span class="kd">implements</span> <span class="n">gimple</span><span class="o">.</span><span class="na">ServiceProviderInterface</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="nf">register</span><span class="o">(</span><span class="n">Container</span> <span class="n">gimple</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// register some services and parameters</span>
        <span class="c1">// on gimple</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Then, register the provider on a Container:</p>

<div class="highlight highlight-groovy"><pre><span class="n">gimple</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">FooProvider</span><span class="o">())</span>
</pre></div>

<h3>
<a name="fetching-the-service-creation-function" class="anchor" href="#fetching-the-service-creation-function"><span class="octicon octicon-link"></span></a>Fetching the Service Creation Function</h3>

<p>When you access an object, Gimple automatically calls the closure that you defined, which creates the service object for you. If you want to get raw access to the closure, you can use the raw() method:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'session'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span> <span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nf">Session</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">])</span>
<span class="o">};</span>

<span class="kt">def</span> <span class="n">sessionFunction</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="na">raw</span><span class="o">(</span><span class="s1">'session'</span><span class="o">)</span>
</pre></div>

<h2>
<a name="authors-and-contributors" class="anchor" href="#authors-and-contributors"><span class="octicon octicon-link"></span></a>Authors and Contributors</h2>

<p><a href="https://github.com/FbN">Fabiano Taioli</a>  /  <a href="mailto:ftaioli@gmail.com">ftaioli@gmail.com</a></p>

<p><a href="https://github.com/Opalo">Maciek Opa≈Ça</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Gimple maintained by <a href="https://github.com/FbN">FbN</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-20498374-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
