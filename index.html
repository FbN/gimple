<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Gimple by FbN</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Gimple</h1>
        <h2>Micro, performant, and thread safe dependency injection container for jvm. Inspired by PHP Pimple. Written in Groovy. Powered by Google Guava Stripe.</h2>
        <a href="https://github.com/FbN/gimple" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="gimple" class="anchor" href="#gimple"><span class="octicon octicon-link"></span></a>Gimple</h1>

<p>Gimple is a small Dependency Injection Container for Groovy, Java and more generally for JVM. Consists of just one class ( ... maybe two ). Is inspired (and in many points carbon-copied) to the <a href="http://pimple.sensiolabs.org/">PHP Pimple project</a></p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>
<strong>Simple</strong>: one (... maybe two) class.</li>
<li>
<strong>Modern</strong>: strong use of closure</li>
<li>
<strong>Thread safty &amp; efficency</strong>: powered by <a href="https://code.google.com/p/guava-libraries/wiki/StripedExplained">Guava Stripe</a>. Tested with <a href="http://thread-safe.org/">thread-safe.org</a>.</li>
<li>
<strong>Nice API</strong>: the container is an LinkedHashMap extension. In groovy you can use it like a Map, [:].</li>
<li>
<strong>Prototype / Singleton</strong>: define singleton o prototype scoped services or parameters.</li>
</ul><h2>
<a name="why" class="anchor" href="#why"><span class="octicon octicon-link"></span></a>Why!?</h2>

<p>Java, and more generally JVM, already got many dependency injection containers ( spring framework, google guice, picocontainer )
but all of them are heavy libraries composed of dozens of classes. </p>

<p>This is a one class!</p>

<hr><h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Gimple is published via Maven:</p>

<ul>
<li>Maven repository: <a href="https://github.com/FbN/mvn/raw/master/">https://github.com/FbN/mvn/raw/master/</a>
</li>
<li>Maven artifact: com.github.gimple Gimple 0.1.1</li>
</ul><p>If you use gradle simply:</p>

<div class="highlight highlight-groovy"><pre><span class="n">repositories</span> <span class="o">{</span>
    <span class="n">maven</span> <span class="o">{</span>
        <span class="n">url</span> <span class="s1">'https://github.com/FbN/mvn/raw/master/'</span>
    <span class="o">}</span>
<span class="o">}</span> 
<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s1">'com.github.gimple:Gimple:0.1.1'</span>
<span class="o">}</span>
</pre></div>

<h2>
<a name="api" class="anchor" href="#api"><span class="octicon octicon-link"></span></a>API</h2>

<h3>
<a name="instantiate" class="anchor" href="#instantiate"><span class="octicon octicon-link"></span></a>Instantiate</h3>

<div class="highlight highlight-groovy"><pre><span class="kt">def</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">gimple</span><span class="o">.</span><span class="na">Container</span><span class="o">()</span>
</pre></div>

<h3>
<a name="defining-services" class="anchor" href="#defining-services"><span class="octicon octicon-link"></span></a>Defining Services</h3>

<p>A service is an object that does something as part of a larger system. 
Examples of services: a database connection, a templating engine, or a mailer. 
Almost any global object can be a service.
Services are defined by closure that return an instance of an object:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nf">SessionStorage</span><span class="o">(</span><span class="s1">'SESSION_ID'</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">container</span><span class="o">[</span><span class="s1">'session'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nf">Session</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">])</span>
<span class="o">}</span>
</pre></div>

<p>Notice that closure has access to the current container instance, allowing references to other services or parameters.</p>

<p>As objects are only created when you get them, the order of the definitions does not matter.</p>

<p>Using the defined services is also very easy:</p>

<div class="highlight highlight-groovy"><pre><span class="kt">def</span> <span class="n">session</span> <span class="o">=</span> <span class="n">container</span><span class="o">[</span><span class="s1">'session'</span><span class="o">]</span>
</pre></div>

<p>N.B. Groovy map access field notation is not currently supported by Gimple so please use only [] notation or directly call get/put methods. I'm working on this...</p>

<h3>
<a name="defining-factory-services" class="anchor" href="#defining-factory-services"><span class="octicon octicon-link"></span></a>Defining Factory Services</h3>

<p>By default, each time you get a service, Gimple returns the same instance of it. 
If you want a different instance to be returned for all calls, wrap your closure with the factory() method</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'session'</span><span class="o">]</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="na">factory</span><span class="o">(</span> <span class="o">{</span> <span class="n">c</span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nf">Session</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">])</span>
    <span class="o">})</span>
</pre></div>

<p>Now, each call to container['session'] returns a new instance of the session.</p>

<h3>
<a name="defining-parameters" class="anchor" href="#defining-parameters"><span class="octicon octicon-link"></span></a>Defining Parameters</h3>

<p>Defining a parameter allows to ease the configuration of your container from the outside and to store global values:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'cookieName'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'SESSION_ID'</span>
<span class="n">container</span><span class="o">[</span><span class="s1">'sessionStorageClass'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'SessionStorage'</span>
</pre></div>

<p>If not is a closure is a parameter.</p>

<p>If you change the sessionStorage service definition like below:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="s2">"${c['sessionStorageClass']}"</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'cookieName'</span><span class="o">])</span>
<span class="o">}</span>
</pre></div>

<h3>
<a name="protecting-parameters" class="anchor" href="#protecting-parameters"><span class="octicon octicon-link"></span></a>Protecting Parameters</h3>

<p>Because Gimple sees clsure as service definitions, you need to wrap closure with the protect() method to store them as parameters:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'randomFunc'</span><span class="o">]</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="na">protect</span><span class="o">({</span> <span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">()</span> <span class="o">})</span>
</pre></div>

<h3>
<a name="modifying-services-after-definition" class="anchor" href="#modifying-services-after-definition"><span class="octicon octicon-link"></span></a>Modifying Services after Definition</h3>

<p>You can replace a service simple reassigning a new value to id (the service must not be already used).
In some cases you may want to modify a service definition after it has been defined without replacing it. You can see it as a filter applied after the original service.
You can use the extend() method to define additional code to be run on your service just after it is created:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="s2">"${c['sessionStorageClass']}"</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'cookieName'</span><span class="o">])</span>
<span class="o">};</span>

<span class="n">container</span><span class="o">-&gt;</span><span class="n">extend</span><span class="o">(</span><span class="s1">'sessionStorage'</span><span class="o">,</span> <span class="o">{</span><span class="n">storage</span><span class="o">,</span> <span class="n">c</span><span class="o">-&gt;</span>
    <span class="o">...</span>
    <span class="k">do</span> <span class="n">anything</span> <span class="n">with</span> <span class="n">storage</span> <span class="n">and</span> <span class="n">c</span>
    <span class="o">...</span>

    <span class="n">storage</span>
<span class="o">})</span>
</pre></div>

<p>The first argument is the name of the service to extend, the second a function that gets access to the object instance and the container.</p>

<h3>
<a name="extending-a-container" class="anchor" href="#extending-a-container"><span class="octicon octicon-link"></span></a>Extending a Container</h3>

<p>If you use the same libraries over and over, you might want to reuse some services from one project to the next one; package your services into a provider by implementing gimple.ServiceProviderInterface:</p>

<div class="highlight highlight-groovy"><pre><span class="kd">class</span> <span class="nc">FooProvider</span> <span class="kd">implements</span> <span class="n">gimple</span><span class="o">.</span><span class="na">ServiceProviderInterface</span>
<span class="o">{</span>
    <span class="kt">def</span> <span class="nf">register</span><span class="o">(</span><span class="n">Container</span> <span class="n">gimple</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="c1">// register some services and parameters</span>
        <span class="c1">// on gimple</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Then, register the provider on a Container:</p>

<div class="highlight highlight-groovy"><pre><span class="n">gimple</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">FooProvider</span><span class="o">())</span>
</pre></div>

<h3>
<a name="fetching-the-service-creation-function" class="anchor" href="#fetching-the-service-creation-function"><span class="octicon octicon-link"></span></a>Fetching the Service Creation Function</h3>

<p>When you access an object, Gimple automatically calls the closure that you defined, which creates the service object for you. If you want to get raw access to the closure, you can use the raw() method:</p>

<div class="highlight highlight-groovy"><pre><span class="n">container</span><span class="o">[</span><span class="s1">'session'</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span> <span class="n">c</span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nf">Session</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="s1">'sessionStorage'</span><span class="o">])</span>
<span class="o">};</span>

<span class="kt">def</span> <span class="n">sessionFunction</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="na">raw</span><span class="o">(</span><span class="s1">'session'</span><span class="o">)</span>
</pre></div>

<hr><h2>
<a name="authors-and-contributors" class="anchor" href="#authors-and-contributors"><span class="octicon octicon-link"></span></a>Authors and Contributors</h2>

<p><a href="https://github.com/fbn" class="user-mention">@fbn</a> Fabiano Taioli  <a href="mailto:ftaioli@gmail.com">ftaioli@gmail.com</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/FbN/gimple/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/FbN/gimple/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/FbN/gimple"></a> is maintained by <a href="https://github.com/FbN">FbN</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-20498374-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>